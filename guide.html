<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Chopper</title>
    <!--<link rel="stylesheet" type="text/css" href="css/bootstrap.css">-->
    <link rel="stylesheet" type="text/css" href="css/codemirror.css">
    <link rel="stylesheet" type="text/css" href="css/eclipse.css">
    <link rel="stylesheet" type="text/css" href="css/eclipse-dim.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <script type="text/javascript" src="./js/tether.min.js"></script>    
    <script type="text/javascript" src="./js/jquery-2.2.4.min.js"></script>
    <script type="text/javascript" src="./js/bootstrap.js"></script>
    <script type="text/javascript" src="./js/preloadjs-0.6.2.min.js"></script>
    <script type="text/javascript" src="js/codemirror.js"></script>
    <script type="text/javascript" src="js/bk-lang.js"></script>
    <script type="text/javascript" src="./js/easeljs-0.8.2.min.js"></script>

  </head>
  <body style="margin-left: 20px">

    <h1>Autodrone</h1>

    <p>The object of Autodrone is to program a drone to put out wildfires.
    But before we start programming drones, let&rsquo;s play the game with
    manual controls. Use the arrow keys to control the drone&rsquo;s flight, and press space
    to drop water balloons. Land the
    drone once you&rsquo;ve put out all the fires. Then, scroll down to learn
    how to program the drone.
    </p>

    <div id="chopper1" class="chopper-div">
      <canvas width="1000" height="300" class="chopper-canvas"></canvas> 
      <div>
        <button id="chopper1-playPauseButton" type="button" class="btn btn-secondary" onclick="Controller.playPauseClick('chopper1')">Pause</button>
        <button id="chopper1-resetButton" type="button" class="btn" onclick="Controller.resetClick('chopper1')">Reset</button>
        <span id="chopper1-error-box"></span>
      </div>
    </div>

    <h2>1. Generating upward thrust</h2>

    <hr>

    <p>
    This section presents a very simple program for the drone. All, you do
    is type in <tt>thrustUp = 15 meters/second^2</tt> in the code editor
    beneath the game. Then hit play. (Well, you&rsquo;ll see I already
    typed it in for you.)
    </p>

    <div id="chopper2" class="chopper-div">
      <canvas width="1000" height="300" class="chopper-canvas"></canvas> 
      <div>
        <button id="chopper2-playPauseButton" type="button" class="btn" onclick="Controller.playPauseClick('chopper2')">Play</button>
        <button id="chopper2-resetButton" type="button" class="btn" onclick="Controller.resetClick('chopper2')">Reset</button>
          <span id="chopper2-error-box"></span>
      </div>
      <div class="editor-div">
        <textarea id="chopper2-editor"></textarea>
      </div>
    </div>

    <h3>1.1 How thrustUp works</h3>

    <p>
    So what&rsquo;s going on here? A &ldquo;tick&rdquo; occurs every thirtieth
    of a second. And on every tick the drone
    executes the program, as written in the code editor.</p>

    <p> The point of the 
    program is to assign values to the drone, which determines the drone behavior.
    </p>

    <p>
    In this example, the drone continually assigns the value 
    <tt>15 meters/second^2</tt> to the variable named <tt>thrustUp</tt>.
    Thus, according to this program, <tt>thrustUp</tt> is always set to 
    <tt>15 meters/second^2</tt>.
    </p>

    <p>
    The <tt>thrustUp</tt> value determines how much upward thrust the drone 
    creates by spinning its blades.
    </p>

    <p>
    Explore other values for <tt>thrustUp</tt> to see how it effects
    drone behavior.
    </p>

    <h2>2. Minimal upward thrust</h2>

    <hr>

    <p>
    Let&rsquo;s determine the minimal amount of upward thrust needed
    for the drone to overpower gravity. (This will come in handy for 
    Section 3.)
    </p>

    <p>We know that <tt>15 meters/second^2</tt> is sufficient, so let&rsquo;s
    see if <tt>7.5</tt> is sufficient (half of <tt>15</tt>). 

    <div id="chopper3" class="chopper-div">
      <canvas width="1000" height="300" class="chopper-canvas"></canvas> 
      <div>
        <button id="chopper3-playPauseButton" type="button" class="btn btn-secondary" onclick="Controller.playPauseClick('chopper3')">Play</button>
        <button id="chopper3-resetButton" type="button" class="btn" onclick="Controller.resetClick('chopper3')">Reset</button>
          <span id="chopper3-error-box"></span>
      </div>
      <div class="editor-div">
        <textarea id="chopper3-editor"></textarea>
      </div>
    </div>

    <h3>2.1 Binary search</h3>

    <p><tt>7.5</tt> doesn&rsquo;t generate enough thrust to overcome gravity.
    So now let&rsquo;s try <tt>11.25</tt>, the midpoint between <tt>7.5</tt> and <tt>15</tt></p>

    <p>
    <tt>11.25</tt> is sufficient. Let&rsquo;s try <tt>9.36</tt> the midpoint between <tt>7.5</tt>
    and <tt>11.25</tt>
    </p>

    <p>
    <tt>9.36</tt> is not sufficient. Let&rsquo;s try <tt>10.31</tt> the midpoint between <tt>9.36</tt>
    and <tt>11.25</tt>
    </p>

    <p>
    <tt>10.31</tt> is sufficient. Let&rsquo;s try <tt>9.86</tt> the midpoint between <tt>9.36</tt>
    and <tt>10.31</tt>
    </p>

    <p>
    <tt>9.86</tt> is sufficient. Let&rsquo;s try <tt>9.61</tt> the midpoint between <tt>9.36</tt>
    and <tt>9.86</tt>
    </p>


    <p>
    <tt>9.61</tt> is not sufficient. Let&rsquo;s try <tt>9.76</tt> the midpoint between <tt>9.61</tt>
    and <tt>9.86</tt>
    </p>

    <p>
    <tt>9.76</tt> is not sufficient. Let&rsquo;s try <tt>9.81</tt> the midpoint between <tt>9.76</tt>
    and <tt>9.86</tt>
    </p>

    <p>
    <tt>9.81</tt> is sufficient. Let&rsquo;s try <tt>9.79</tt> the midpoint between <tt>9.76</tt>
    and <tt>9.81</tt>
    </p>

    <p>
    <tt>9.79</tt> is not sufficient. Let&rsquo;s try <tt>9.80</tt> the midpoint between <tt>9.79</tt>
    and <tt>9.81</tt>
    </p>


    <p>
    <tt>9.80</tt> is not sufficient!!!  Therefore, <tt>9.81</tt> is the minimal
    thrust needed to overcome gravity!!! (If we're measuring to two decimal places)
    </p>



    <h3>2.2 The result of the binary search</h3>

    <p>
    We can stop searching now because we know <tt>9.80</tt> is insufficient and
    and <tt>9.81</tt> is insufficient, therefore the minimal thrust needed to overcome
    gravity is somewhere between <tt>9.80</tt> and <tt>9.81</tt>. (If we wanted
    to, we could do the same search but to three decimal places and find a more
    precise answer)
    </p>

    <h3>2.3 What is binary search?</h3>

    <p>
    The technique we used to find <tt>9.81</tt> is called &ldquo;binary
    search.&rdquo; The <a href="https://en.wikipedia.org/wiki/Binary_search_algorithm">Wikipedia page</a> for binary search does a great job of obscuring the simplicity
    of the algorithm. Here&rsquo;s a better article by <a href="http://www.businessinsider.com/introduction-to-binary-search-2013-11">Business Insider</a>.
    </p>

    <h3>2.3 Another approach to this problem</h3>

    <p>
    We could have just googled: &ldquo;gravity on Earth&rdquo;: 
    <p>

    <img src="img/gravity-google.png" width="600px">


    <h2>3. Vertical stabilization</h2>

    <hr>

    <p>We would like our drone
    to hover at an altitude. But first, let&rsquo;s look at an 
    oscillating drone:</p>

    <div id="chopper4" class="chopper-div">
      <canvas width="1000" height="300" class="chopper-canvas"></canvas> 
      <div>
        <button id="chopper4-playPauseButton" type="button" class="btn btn-secondary" onclick="Controller.playPauseClick('chopper4')">Play</button>
        <button id="chopper4-resetButton" type="button" class="btn" onclick="Controller.resetClick('chopper4')">Reset</button>
          <span id="chopper4-error-box"></span>
      </div>
      <div class="editor-div">
        <textarea id="chopper4-editor"></textarea>
      </div>
    </div>


    <h3>3.1 An oscillating drone</h3>

    <p>
    Every tick, the drone checks its altitude. If the altitude is less than
    6, then it sets the thrust to 15. If the altitude is greater 
    than (or equal to) 6, then the program sets the drone&rsquo;s thrust to 0.
    </p>

    <p>
    Why does this result in oscillating behavior?
    </p>

    <ol>
      <li>When the drone reaches a height of 6, the drone shuts off its engine.</li>
      <li>But it doesn't starting falling right away, because of it's forward momentum</li>
      <li>Rather, the drone continues flying upward until it reaches its apex, some distance above 6 meters</li>
      <li>Then the drone starts falling</li>
      <li>Once the drone falls below 6 meters, the engines kick in again</li>
      <li>But, due to the downward momentum, it takes time before the engine provides enough
          thrust to push the drone upwards again.</li>
      <li>Then the process repeats.</li>
    </ol>

    <h3>3.2 What if we removed the <tt>else</tt> component of the program </h3>

    <p>
    The program below is perfectly valid, although it&rsquo;s kind of silly.
    </p>

    <div id="chopper5" class="chopper-div">
      <canvas width="1000" height="300" class="chopper-canvas"></canvas> 
      <div>
        <button id="chopper5-playPauseButton" type="button" class="btn btn-secondary" onclick="Controller.playPauseClick('chopper5')">Play</button>
        <button id="chopper5-resetButton" type="button" class="btn" onclick="Controller.resetClick('chopper5')">Reset</button>
          <span id="chopper5-error-box"></span>
      </div>
      <div class="editor-div">
        <textarea id="chopper5-editor"></textarea>
      </div>
    </div>


    <p>In the above program, whenever the altitude is greater than (or equal to)
    6 meters, then the <tt>then</tt> component does not get executed. In this
    case, the <tt>thrustUp</tt> variable is not updated. And since it&rsquo;s
    not updated, it retrains its previous value from the previous tick.</p>

    <p>Thus, in this program, <tt>thrustUp</tt> will always be set to <tt>15</tt>.


    <h3>3.3 Takeoff, then stabilize</h3>

    <p>Here&rsquo;s a drone that takes off, then hovers at altitude:</p>

    <div id="chopper6" class="chopper-div">
      <canvas width="1000" height="300" class="chopper-canvas"></canvas> 
      <div>
        <button id="chopper6-playPauseButton" type="button" class="btn btn-secondary" onclick="Controller.playPauseClick('chopper6')">Play</button>
        <button id="chopper6-resetButton" type="button" class="btn" onclick="Controller.resetClick('chopper6')">Reset</button>
          <span id="chopper6-error-box"></span>
      </div>
      <div class="editor-div">
        <textarea id="chopper6-editor"></textarea>
      </div>
    </div>

    <p>How does it work? Once the drone reaches an altitude above 6 meters,
    it oscillates between two different thrusts, depending upon the speed
    of the drone.</p>

    <p>If the drone is moving upward (i.e. has an positive speed going upward)
    then the drone needs to drop down&mdash;but only a little, and only gently.
    We don't want the drone to fall down much, because then the altitude won't be stable.
    </p>

    <p>Similarly, if the drone is moving downward, then the drone needs to fly
    upward&mdash;but only a little, and only gently.
    </p>

    <h3>3.3 Failed attempts at stabilization</h3>

    <p>Vertical stability is sensitive the various values of thrust
    you specify in the program:</p>

    <ul>
      <li>If your initial thrust is too high (e.g. <tt>15)</tt>), the drone will shoot past the 
      target altitude
      </li>
      <li>If your stabilizing ascending thrust is too high (e.g. <tt>15</tt>), the
      drone will continue moving upward after the altitude is reached.</li>
      <li>If your stabilizing descending thrust is too low (e.g. <tt>8</tt>), the
      drone will continue moving downward after the altitude is reached.</li>
    </ul>

    <p>
    Try out different thrust values in the program for Section 3.3, to see
    how bad values for thrust result in undesirable behavior.
    </p>

    <h2>4. Horizontal flight</h2>

    <hr>

    <p>
    Now that we have a drone that is vertically stable, it is time to make
    it fly horizontally so it can fly over the fires. (In Section 5, we
    will program the drone to drop water balloons on the fires.)
    </p>

    <div id="chopper7" class="chopper-div">
      <canvas width="1000" height="300" class="chopper-canvas"></canvas> 
      <div>
        <button id="chopper7-playPauseButton" type="button" class="btn btn-secondary" onclick="Controller.playPauseClick('chopper7')">Play</button>
        <button id="chopper7-resetButton" type="button" class="btn" onclick="Controller.resetClick('chopper7')">Reset</button>
          <span id="chopper7-error-box"></span>
      </div>
      <div class="editor-div">
        <textarea id="chopper7-editor"></textarea>
      </div>
    </div>

    <script type="text/javascript" src="./target/scala-2.11/chopper-fastopt.js"></script>

    <h3>4.1 How it works</h3>

    <p>
    We added the following code right after the vertical stabilization
    component:
    </p>

    <pre>
  if (speedRight < 1 meters/second) {
    thrustRight = 1.0 meters/second^2
  } else {
    thrustRight = 0.0 meters/second^2
  }
    </pre>

    <p>
    The reason we set <tt>thrustRight = 0.0</tt> when the speed is above 1,
    is because the drone coasts like a hockey puck through the air. I.e.,
    once the desired speed is reached, we cut the rightward thrust, and let
    the drone coast.
    </p>

    <p>
    In the real world, air drag would slow rightward speed, but I have not
    programmed air drag into the game.
    </p>


  </body>
</html>

























